---
title: "Getting Started with ParametricSurvFit"
author: "Gosuke Homma"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with ParametricSurvFit}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE  # Set to TRUE when you have actual data
)
```

## Introduction

The `ParametricSurvFit` package provides a comprehensive suite of functions for fitting parametric survival distributions to clinical trial data. This vignette demonstrates the main functionality using ADaM datasets commonly used in pharmaceutical research.

## Installation

```{r installation}
# Install from GitHub
devtools::install_github("gosukehommaEX/ParametricSurvFit")

# Load the package
library(ParametricSurvFit)
```

## Overview of Functions

The package provides four main functions:

1. **`DataParametricSurv()`**: Prepares ADaM datasets for survival analysis
2. **`FitSurvMods()`**: Fits multiple parametric distributions and creates formatted tables
3. **`ExtractParams()`**: Extracts parameters from individual fitted models
4. **`ExtractCovarianceMatrix()`**: Extracts variance-covariance matrices from fitted models

## Basic Workflow

### Step 1: Prepare the Data

```{r data_prep}
# Basic usage - Overall Survival analysis with sex stratification
surv_data <- DataParametricSurv(
  adsl_path = "path/to/adsl.sas7bdat",
  adtte_path = "path/to/adtte.sas7bdat",
  population = "ITTFL",      # ITT population
  variable = "OS",           # Overall Survival
  stratify_by = "SEX"        # Stratify by sex
)

# View the structure of the prepared data
str(surv_data)
head(surv_data)
```

### Step 2: Fit Parametric Models

```{r fit_models}
# Fit all available distributions
results_all <- FitSurvMods(
  dataset = surv_data,
  table_caption = "Parametric Models for Overall Survival by Sex"
)

# Display the formatted table
results_all
```

### Step 3: Extract Covariance Matrices

```{r covariance_analysis}
# Extract covariance matrix for Weibull distribution
cov_weibull <- ExtractCovarianceMatrix(
  dataset = surv_data,
  distribution = "weibull",
  parameter_name = "Overall Survival",
  stratify_reference_level = "M",  # Use Male as reference
  create_kable = TRUE
)

# Display the formatted covariance matrix
print(cov_weibull)
```

## Advanced Examples

### Example 1: Covariance Matrix with Shape Parameters

```{r advanced_covariance}
# Gamma with shape parameter included
cov_gamma_shape <- ExtractCovarianceMatrix(
  dataset = surv_data,
  distribution = "gamma",
  include_shape = TRUE,
  stratify_reference_level = "F",  # Use Female as reference
  parameter_name = "Overall Survival with Shape",
  create_kable = TRUE
)

print(cov_gamma_shape)
```

### Example 2: Multiple Distribution Analysis

```{r multiple_distributions}
# Compare covariance matrices across distributions
distributions_to_test <- c("exp", "weibull", "gamma")

for (dist in distributions_to_test) {
  cov_result <- ExtractCovarianceMatrix(
    dataset = surv_data,
    distribution = dist,
    stratify_reference_level = "M",
    parameter_name = paste("Overall Survival -", toupper(dist))
  )
  
  cat("\n=== Covariance Matrix for", toupper(dist), "Distribution ===\n")
  print(cov_result)
}
```

## Session Information

```{r session_info}
sessionInfo()
```
